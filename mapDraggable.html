<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>jQuery UI Draggable - Default functionality</title>
	<style>
	html, body{
		padding: 0;
		margin: 0;
		width: 100%;
		height: 100%;
	}
	#draggable {
		width: 650px;
		height: 650px;
		padding: 0.5em;
		border: solid 1px black;
	}
	#map{
		border: solid 5px red;
		width: 100%;
		height: 100%;
		overflow: hidden;
	}
	#map img{
		width: 4000px;
		height: 4000px;
	}
	</style>
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>
<body>

<div id="map">
	<img src="https://www.codeur.com/blog/wp-content/uploads/2018/06/google-maps-payant-700x423.jpg" alt="" />
</div>

<script>
// info mise a jour en permance
var mapW;
var mapH;
var x;
var y;
var w;
var h;
var xw;
var yh;
var initPosX;
var initPosY;

// mis a jour uniquement en mousedown pour connaitre
// la distance entre le clic de la souris sur l'image
// et les bord haut gauche de l'image.
// Ceci permet de déplacer l'image et la souris
// avec toujours la meme distance
var currentPosX;
var currentPosY;


// valeur pour la molette de la souris
var newW;
var newH;
var newX;
var newY;


function cssData(){
	window.mapW = parseInt($('#map').css('width'));
	window.mapH = parseInt($('#map').css('height'));

	window.x = parseInt($('#map img').css('margin-left'));
	window.y = parseInt($('#map img').css('margin-top'));
	window.w = parseInt($('#map img').css('width'));
	window.h = parseInt($('#map img').css('height'));
	window.xw = x + w;
	window.yh = y + h;
}

$( function() {
	var isDrag = false;
	$("#map").on('wheel', function(event){
		if (w-10 > mapW && h-10 > mapH) {
			if(event.originalEvent.deltaY < 0){
				newW = w + 10;
				newH = h + 10;
				newX = x - 5;
				newY = y - 5;
		  }else {
				if( x > (mapW-w)){
					newW = w - 10 ;
				}
				if( y > (mapH-h)){
					newH = h - 10;
				}
				if(x > 0){
					newX = 0;
				}else{
					newX = x + 5;
				}
				if(y > 0){
					newY = 0;
				}else{
					newY = y + 5;
				}
		  }
			parseInt($('#map img').css('margin-left', newX+'px'));
			parseInt($('#map img').css('margin-top', newY+'px'));
			parseInt($('#map img').css('width', newW+'px'));
			parseInt($('#map img').css('height', newH+'px'));

			// met à jour toutes les données css concernant le container et l'image
			cssData();

			if( x < (mapW-w)){
				$('#map img').css( 'margin-left', ((mapW-w))+'px' ) ;
				isDrag = false;
			}

		}else{
			parseInt($('#map img').css('margin-left', '-11px'));
			parseInt($('#map img').css('margin-top', '-11px'));
			parseInt($('#map img').css('width', (mapW+11)+'px'));
			parseInt($('#map img').css('height', (mapH+11)+'px'));

			// met à jour toutes les données css concernant le container et l'image
			cssData();
		}
	});

	$( "#map img" ).mousedown(function(event){
		var decalx = parseInt($('#map img').css('margin-left'));
		var decaly = parseInt($('#map img').css('margin-top'));
		isDrag = true;
		// calcule la distance entre la position du curseur et l'image
		initPosX = (event.pageX-decalx);
		initPosY = (event.pageY-decaly);

		return false;
	});
	$('#map').on('mouseup mouseleave', function() {
	    isDrag = false;
	});
	$('#map').mousemove(function(event){
		// met à jour toutes les données css concernant le container et l'image
		cssData();

		if(isDrag){
			// la distance est deja calculé pour comprendre que la souris reste a la bonne
			// distance du bord haut gauche de l'image ce qui correspond a initPosX.
			// Maintenant grace au deplacment de la souris l'image aussi
			// ce déplace avec toujours la meme distance entre les bord haut gauche et le curseur de la souris
			currentPosX = -(initPosX - event.pageX);
			$('#map img').css( 'margin-left', currentPosX+'px' )

			if(x > 0){
				 $('#map img').css( 'margin-left', '0px' )
				 isDrag = false;
			}
			// taille du container plus petite que limage.
			// ce qui fait une valeur négatif.
			// si x recule de trop en dessous de cette limite alors c'est
			// que le bord right de limage devient inferieur au bord right du container
			if( x < (mapW-w)){
				$('#map img').css( 'margin-left', ((mapW-w))+'px' ) ;
				isDrag = false;
			}

			// fait l'action du drag.
			// l'action prend en compte la derniere position de l'image grace a initposy
			// qui corespond a la position de l'image lorsque le drag est fini
			currentPosY = -(initPosY - event.pageY);
			$('#map img').css( 'margin-top', currentPosY+'px' ) ;

			if(y > 0){
				 $('#map img').css( 'margin-top', '0px' )
				 isDrag = false;
			}

			// meme chose que plus haut pour if( x < (mapW-w)){
			if( y < (mapH-h)){
				$('#map img').css( 'margin-top', -(h-mapH)+'px' ) ;
				isDrag = false;
			}


		}
	})
} );
</script>
</body>
</html>
